---
- name: bootstrap an ubuntu microk8s worker vagrant box
  hosts: all, localhost
  become: true
  vars_files:
  - vars.yml

  tasks:
  - name: install microk8s snap
    community.general.snap:
      name: microk8s
      state: present
      channel: "{{ kube_version }}/stable"
      classic: true

  - name: start microk8s
    ansible.builtin.command: microk8s.start

  - name: join kubernetes cluster
    ansible.builtin.command: "{{ lookup('ansible.builtin.file', 'cluster_join' + worker | string) }} --worker"
